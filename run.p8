pico-8 cartridge // http://www.pico-8.com
version 32
__lua__


function _init()
	player = {}
	player.x = 1
	player.y = 10

	player.facing_x = 0
	player.facing_y = 0
	player.speed = 0

 -- stores the movement sets. nested, first layer is player speed
 -- second layer is button index

	mov = {
		{{x=-1,y=0, facing_x=-1, facing_y=0, key=0},
			{x=1,y=0, facing_x=1, facing_y=0, key=1},
			{x=0,y=-1, facing_x=0, facing_y=-1, key=2},
 		{x=0,y=1, facing_x=0, facing_y=1, key=3}},

		{{x=1,y=1, facing_x=1, facing_y=0, key=0, speed=1},
			{x=-1,y=1, facing_x=-1, facing_y=0, key=1, speed=1},
			{x=0,y=2, facing_x=0, facing_y=1, key=2, speed=2},
			{x=0,y=1, facing_x=0, facing_y=0, key=3, speed=0}},

		{{x=1,y=0, facing_x=1, facing_y=0, key=0, speed=1},
			{x=-1,y=0, facing_x=-1, facing_y=0, key=1, speed=1},
			{x=0,y=1, facing_x=0, facing_y=1, key=2, speed=1},
			{x=0,y=-1, facing_x=0, facing_y=-1, key=3, speed=1}}
		}

end


function _update()

	local x=0
	local y=0

	-- move based on current move set matrix

	for i=0,3,1 do
		if (btnp(i)) then
			x+=mov[1][i+1].x
			y+=mov[1][i+1].y
		end
	end

	if(x != 0 or y !=0) then
		move(x,y)
	end
end

function move(x,y)
	-- apply move
	-- test passability of target
	-- in future, will need to test passability of
	-- all intermediate tiles
	target={}
	target.x=player.x + x
	target.y=player.y + y

	passable = not fget(mget(target.x,target.y),0)

	if (passable) then
		player.facing_x = x
		player.facing_y = y

		player.x+=x
		player.y+=y

	end
end


function _draw()
	cls()
	map(0,0,0,0,16,16)
	spr(1,player.x*8,player.y*8) -- don't love the magic 8

	local facing_spr=0
	if(player.facing_x == 1) then facing_spr = 1 end
	if(player.facing_x == -1) then facing_spr = 2 end
	if(player.facing_y == 1) then facing_spr = 3 end
	if(player.facing_y == -1) then facing_spr = 4 end


	if(facing_spr!=0) then
		spr(1+facing_spr,player.x*8,player.y*8)
	end
	-- speed indicator show here


 -- draw movement keypad
	for i=1, #mov, 1 do
		if(i!=5 and mov[i].key != nil) then
			 spr(mov[i].key+6,(player.x+mov[i].x)*8,(player.y+mov[i].y)*8)
		end
	end
	-- debug vis


	print(player.x,0,0)
	print(player.y,24,0)

	print(fget(mget(player.x,player.y),0),0,8)

end
__gfx__
00000000007007000000008000000080000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000007777770000000080000080000000808000008080000b000000b0000000bb000000bb000000000000000000000000000000000000000000000000000
0070070007077070000000800000008000000080000000000000bb0000bb0000000bb00000bbbb00000000000000000000000000000000000000000000000000
0007700007777770000000000000000000000000000000000bbbbbb00bbbbbb0000bb0000bbbbbb0000000000000000000000000000000000000000000000000
0007700000666600000000000000000000000000000000000bbbbbb00bbbbbb00bbbbbb0055bb550000000000000000000000000000000000000000000000000
0070070000666600000000000000000000000000000000000555bb5005bb555005bbbb50000bb000000000000000000000000000000000000000000000000000
0000000000600600000000000000000000000000000000000000b500005b0000005bb500000bb000000000000000000000000000000000000000000000000000
00000000006006000000000000000000000000000000000000005000000500000005500000055000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77777777001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
4040404040404040404040404040404042000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414042000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414042000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141404040404141414000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141404040404141414000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141404040404141414000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4041414141414141414141414141414000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4040404040404040404040404040404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
